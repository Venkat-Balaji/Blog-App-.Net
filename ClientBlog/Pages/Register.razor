@page "/register"
@inject ISnackbar Snackbar
@inject Supabase.Client SupabaseClient
@inject NavigationManager Navigation
@using MudBlazor
@using ClientBlog.Services
@inject AuthService AuthService;
@inject SupabaseService Supabase;


<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-12 d-flex justify-center">
    <MudCard Style="width:100%; max-width:450px;">
        <MudCardContent>
            <MudStack Spacing="2">
                <MudText Typo="Typo.h5" Align="Align.Center">Create a New Account</MudText>

                <MudTextField Label="Email" @bind-Value="Email" Placeholder="email@example.com" Required="true" />
                <MudTextField Label="Password" @bind-Value="Password" InputType="InputType.Password" Required="true" />

                @if (!string.IsNullOrEmpty(ErrorMessage))
                {
                    <MudText Color="Color.Error">@ErrorMessage</MudText>
                }

                <MudButton OnClick="RegisterUser" Variant="Variant.Outlined" Color="Color.Secondary" FullWidth="true">Register</MudButton>

                <MudText Typo="Typo.caption" Align="Align.Center" Class="mt-2">
                    Already have an account?
                    <MudLink Href="/login" Color="Color.Primary">Log in</MudLink>
                </MudText>
            </MudStack>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private string Email = string.Empty;
    private string Password = string.Empty;
    private string ErrorMessage;

    private async Task RegisterUser()
    {
        try
        {
            await SupabaseClient.Auth.SignUp(Email, Password);
            Snackbar.Add("Registration successful!", Severity.Success);
            Navigation.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            ErrorMessage = $"Registration failed: {ex.Message}";
        }
    }
}
